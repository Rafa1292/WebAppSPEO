@model IEnumerable<WebApplication1.Models.Ubication>

@{
    ViewBag.Title = "Index";
}

<div class="justify-content-center d-flex">
    <h3 class="url-label">Ubicaciones</h3>
</div>

<div class="d-flex mb-2">
    @Html.ActionLink("Agregar ubicacion", "Create", null, new { @class = "btn btn-outline-primary" })
</div>
<hr />


<div class="container-fluid d-flex" style="flex-wrap:wrap">
    @foreach (var item in Model)
    {
        <div class="col-md-2 card-style p-0  shadow rounded d-flex text-center">
            <div class="col-md-12 card-header-style">
                <strong>@Html.DisplayFor(modelItem => item.UbicationCategory.Name)</strong>
                <label>@item.Name</label>
            </div>
            <div class="col-md-12 " style="height:140px">
                @foreach (var outstandingPicture in ViewBag.Selectedurl)
                {
                    if (outstandingPicture.UbicationId == item.UbicationId)
                    {
                        var base64 = Convert.ToBase64String(outstandingPicture.PictureArray);
                        var imgSrc = String.Format("data:image/png;base64,{0}", base64);

                        <img class="rounded" src="@imgSrc" style="max-width:180px; height: 120px;">
                    }

                }

            </div>

            <div class="col-md-12 icAlignStyle">

                @foreach (var Distrit in ViewBag.DistritId)
                {
                    string content = "";

                    if (Distrit.DistritId == item.DistritId)
                    {
                        foreach (var Canton in ViewBag.CantonId)
                        {
                            content += Canton.CantonId == Distrit.CantonId ? Canton.Name + ", " : "";
                        }
                        content += Distrit.Name;
                        <em>@content</em>
                        break;
                    }
                }
            </div>
            <div class="col-md-12 mb-3 icAlignStyle text-left " style="height: 80px;">
                @{
                    var id = item.UbicationId;
                }
                <button type="button" class="btn btn-info" data-toggle="modal" onclick="fillFeaturesModal(@id, 'Caracteristicas incluidas')">
                    Caracteristicas incluidas
                </button>

            </div>
            <div class="col-md-12 icAlignStyle">
                @Html.ActionLink("Editar", "Edit", new { id = item.UbicationId }, new { @class = "btn btn-outline-secondary" })
                  @*@Html.ActionLink("Borrar", "Delete", new { id = item.UbicationId }, new { @class = "btn btn-outline-danger delete-button" })*@
            </div>
            <div class="col-md-12">
                <span><a href="/Ubications/Delete/@id"><i onclick="deleteItemModal(@id)" class="fas fa-trash-alt trash-button"></i></a></span>
            </div>
        </div>
    }
    <!-- Modal -->
    <div class="modal fade" id="UbicationFeaturesModal" tabindex="-1" role="dialog" aria-labelledby="UbicationFeaturesLabel" aria-hidden="true">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="UbicationFeatureslLabel"></h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body">
                    <ul class="list-group list-group-flush" id="ModalFeaturesList">
                    </ul>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-outline-success" data-dismiss="modal">Listo!</button>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    function fillFeaturesModal(UbicationId, title) {
        var modalHeader = document.getElementById("UbicationFeatureslLabel");
        var modalList = document.getElementById("ModalFeaturesList");
        modalList.innerHTML = "";
        modalHeader.innerHTML = ""

        $.ajax({
            type: "POST",
            url: '@Url.Action("FillFeaturesModal")',
            data: { UbicationId: UbicationId },
            cache: false
        })
            .then(function (data) {
                modalList.innerHTML = data;
                modalHeader.innerHTML = title;
                $("#UbicationFeaturesModal").modal();
            })
            .fail(function (data) {
                alert('No');
            })
        return false;
    }




</script>